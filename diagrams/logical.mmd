flowchart TB
  subgraph Producer Plane (GCP)
    N1[Cloud Run: Normalize events]
    N2[GCS: Raw snapshots]
    N3[Pub → Kafka via Confluent connector]
  end

  subgraph Backbone
    K1[(Kafka: price.topic)]
    K2[(Kafka: inventory.topic)]
    SRG[(Schema Registry)]
    DLT[(Kafka: *.DLQ)]
  end

  subgraph Consumer Plane (Azure)
    C1[Azure Functions: price handler]
    C2[Azure Functions: inventory handler]
    P1[(Cosmos DB Containers)]
    API[API Management]
  end

  subgraph Analytics & Audit
    DF[Dataflow (Kafka → BQ)]
    BQ[(BigQuery tables: audit.events)]
    SYN[(Synapse/ADX dashboards)]
  end

  N1 --> K1
  N1 --> K2
  K1 --> C1 --> P1
  K2 --> C2 --> P1
  K1 -.-> DLT
  K2 -.-> DLT
  K1 --> DF --> BQ
  K2 --> DF --> BQ
  API -->|Read APIs| EndUsers[Apps/Services]
